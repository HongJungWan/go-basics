package main

import (
	"fmt"
	"sync"
	"time"
)

var mutex sync.Mutex

type Account struct {
	Balance int
}

func main() {
	var wg sync.WaitGroup

	account := &Account{0}
	wg.Add(10)
	for i := 0; i < 10; i++ {
		go func() {
			for {
				DepositAndWithdraw(account)
			}
			wg.Done()
			fmt.Println("ê³ ë£¨í‹´ ë")
		}()
	}
	wg.Wait()
}

func DepositAndWithdraw(account *Account) {
	mutex.Lock()
	defer mutex.Unlock()

	if account.Balance < 0 {
		panic(fmt.Sprintf("Balance should not be negative vlaue: %d", account.Balance))
	}
	account.Balance += 1000
	time.Sleep(time.Millisecond)
	account.Balance -= 1000
}

/*
ðŸ“Œ ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë° ì£¼ì˜ì 
- ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë°ì˜ ë¬¸ì œì ì€ ë™ì¼í•œ ë©”ëª¨ë¦¬ ìžì›ì— ì—¬ëŸ¬ ê³ ë£¨í‹´ì´ ì ‘ê·¼í•  ë•Œ ë°œìƒí•œë‹¤.
- ê³ ë£¨í‹´ì€ ê° CPU ì½”ì–´ì—ì„œ ë³„ë„ë¡œ ë™ìž‘í•˜ì§€ë§Œ ê°™ì€ ë©”ëª¨ë¦¬ ê³µê°„ì— ë™ì‹œì— ì ‘ê·¼í•´ì„œ ê°’ì„ ë³€ê²½ì‹œí‚¬ ìˆ˜ ìžˆë‹¤.

ðŸ“Œ ë¬¸ì œ ì›ì¸
- account.Balance += 1000 ì½”ë“œì— ìžˆë‹¤. ì´ ì½”ë“œëŠ” ë¨¼ì € Balance ê°’ì„ ì½ê³  1000ì„ ë”í•´ì„œ Balanceì— ë‹¤ì‹œ ì €ìž¥í•˜ëŠ” ë‘ ë‹¨ê³„ë¡œ ì´ë¤„ì§„ë‹¤.
- ì´ë•Œ ì²« ë²ˆì§¸ ë‹¨ê³„ê°€ ì™„ë£Œ ë˜ê¸° ì „ì— ë‹¤ë¥¸ ê³ ë£¨í‹´ì´ ì²« ë²ˆì§¸ ë‹¨ê³„ë¥¼ ìˆ˜í–‰í•˜ë©´ ë‘ ê³ ë£¨í‹´ì€ ë˜‘ê°™ì€ ê°’ì„ ì½ì–´ì„œ 1000ì”© ë”í•´ ë‹¤ì‹œ Balanceì— ì €ìž¥í•œë‹¤.
- ì¦‰, ê³ ë£¨í‹´ 2ê°œê°€ ê°ê° ìž…ê¸ˆì„ í–ˆëŠ”ë° í•œ ë²ˆ ìž…ê¸ˆí•œ íš¨ê³¼ë°–ì— ë‚˜ì§€ ì•Šê²Œ ëœë‹¤. ì´ ìƒíƒœì—ì„œ ì¶œê¸ˆì´ ê°ê° ì´ë£¨ì–´ì§€ë©´ ìž”ê³ ê°€ -ê°€ ëœë‹¤.

ðŸ“Œ ë®¤í…ìŠ¤ë¥¼ ì´ìš©í•œ ë™ì‹œì„± ë¬¸ì œ í•´ê²°
- ê°€ìž¥ ë‹¨ìˆœí•œ í•´ê²° ë°©ë²•ì€ í•œ ê³ ë£¨í‹´ì—ì„œ ê°’ì„ ë³€ê²½í•  ë•Œ ë‹¤ë¥¸ ê³ ë£¨í‹´ì´ ê±´ë“¤ì§€ ëª»í•˜ê²Œ í•˜ëŠ” ê²ƒì´ë‹¤.
- ë®¤í…ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ìžì› ì ‘ê·¼ ê¶Œí•œì„ í†µì œí•  ìˆ˜ ìžˆë‹¤.
- ë®¤í…ìŠ¤ëŠ” mutual exclusionì˜ ì•½ìžì´ë‹¤.

- ë®¤í…ìŠ¤ì˜ Lock() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ë®¤í…ìŠ¤ë¥¼ íšë“í•  ìˆ˜ ìžˆë‹¤.
- ì´ë¯¸ Lock() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ë‹¤ë¥¸ ê³ ë£¨í‹´ì´ ë®¤í…ìŠ¤ë¥¼ íšë“í–ˆë‹¤ë©´ ë‚˜ì¤‘ì— í˜¸ì¶œí•œ ê³ ë£¨í‹´ì€ ì•žì„œ íšë“í•œ ë®¤í…ìŠ¤ê°€ ë°˜ë‚©ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•˜ê²Œ ëœë‹¤.
- ì‚¬ìš© ì¤‘ì´ë˜ ë®¤í…ìŠ¤ëŠ” Unlock() ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ì„œ ë°˜ë‚©í•œë‹¤.
- ì´í›„ ëŒ€ê¸°í•˜ë˜ ê³ ë£¨í‹´ ì¤‘ í•˜ë‚˜ê°€ ë®¤í…ìŠ¤ë¥¼ íšë“í•œë‹¤.

- í•œ ë²ˆ íšë“í•œ ë®¤í…ìŠ¤ëŠ” ë°˜ë“œì‹œ Unlock()ì„ í˜¸ì¶œí•´ì„œ ë°˜ë‚©í•´ì•¼ í•œë‹¤.
*/
