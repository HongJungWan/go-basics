package main

import (
	"fmt"
	"math/rand"
	"sync"
	"time"
)

var wg sync.WaitGroup

func diningProblem(name string, first, second *sync.Mutex, firstName, secondName string) {
	for i := 0; i < 100; i++ {
		fmt.Printf("%s ë°¥ì„ ë¨¹ìœ¼ë ¤ í•©ë‹ˆë‹¤.\n", name)

		first.Lock()
		fmt.Printf("%s %s íšë“\n", name, firstName)

		second.Lock()
		fmt.Printf("%s %s íšë“\n", name, secondName)

		fmt.Printf("%s ë°¥ì„ ë¨¹ìŠµë‹ˆë‹¤.\n", name)
		time.Sleep(time.Duration(rand.Intn(1000)) * time.Millisecond)

		second.Unlock()
		first.Unlock()
	}
	wg.Done()
}

func main() {
	rand.Seed(time.Now().UnixNano())

	wg.Add(2)

	// í¬í¬ì™€ ìˆ˜ì € ë®¤í…ìŠ¤
	fork := &sync.Mutex{}
	spoon := &sync.Mutex{}

	go diningProblem("A", fork, spoon, "í¬í¬", "ìˆ˜ì €")
	go diningProblem("B", spoon, fork, "ìˆ˜ì €", "í¬í¬")

	wg.Wait()
}

/*
ðŸ“Œ ë®¤í…ìŠ¤ì™€ ë°ë“œë½
- ë®¤í…ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´ ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë° ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìžˆì§€ë§Œ, ë˜ ë‹¤ë¥¸ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.
- ì²« ë²ˆì§¸ ë¬¸ì œëŠ” ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë°ìœ¼ë¡œ ì–»ëŠ” ì„±ëŠ¥ í–¥ìƒì„ ì–»ì„ ìˆ˜ ì—†ë‹¤ëŠ” ì ì´ë‹¤.
- ë®¤í…ìŠ¤ëŠ” ì˜¤ì§ í•˜ë‚˜ì˜ ê³ ë£¨í‹´ë§Œ ê³µìœ  ìžì›ì— ì ‘ê·¼í•  ìˆ˜ ìžˆë„ë¡ ì œí•œí•œë‹¤. ë”°ë¼ì„œ ì—¬ëŸ¬ ê³ ë£¨í‹´ ì¤‘ ë®¤í…ìŠ¤ë¥¼ íšë“í•œ ê³ ë£¨í‹´ë§Œ ì‹¤í–‰ëœë‹¤.
- ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¤ë ¤ê³  ë™ì‹œì„± í”„ë¡œê·¸ëž¨ì„ êµ¬í˜„í–ˆì§€ë§Œ ì„±ëŠ¥ í–¥ìƒì„ ì–»ì§€ ëª»í•˜ëŠ” ì•„ì´ëŸ¬ë‹ˆí•œ ë¬¸ì œê°€ ìƒê¸°ê²Œ ëœë‹¤.

- ë‘ ë²ˆìž¬ ë¬¸ì œëŠ” ë°ë“œë½ì´ ë°œìƒí•  ìˆ˜ ìžˆë‹¤ëŠ” ì ì´ë‹¤.
- ë°ë“œë½ì€ í”„ë¡œê·¸ëž¨ì„ ì™„ì „ížˆ ë©ˆì¶”ê²Œ ë§Œë“¤ì–´ ë²„ë¦°ë‹¤.
- ì–´ë–¤ ê³ ë£¨í‹´ë„ ì›í•˜ëŠ” ë§Œí¼ ë®¤í…ìŠ¤ë¥¼ í™•ë³´í•˜ì§€ ëª»í•œë‹¤ë©´ ë¬´í•œížˆ ëŒ€ê¸°í•˜ê²Œ ë˜ëŠ” ê²½ìš°ë¥¼ ë°ë“œë½ì´ë¼ê³  ë§í•œë‹¤.
*/

/*
- ìœ„ ì˜ˆë¥¼ ë³´ë©´ AëŠ” í¬í¬ ë®¤í…ìŠ¤ë¥¼ íšë“í–ˆê³ , BëŠ” ìˆ˜ì € ë®¤í…ìŠ¤ë¥¼ íšë“í–ˆì§€ë§Œ ì„œë¡œ ë‘ ë²ˆì§¸ ë®¤í…ìŠ¤ë¥¼ íšë“í•˜ì§€ ëª»í•´ ë¬´í•œížˆ ëŒ€ê¸°í•˜ê²Œ ë˜ê³ , Go ì–¸ì–´ì—ì„œëŠ” ë°ë“œë½ì„ ê°ì§€í•˜ê³  ì—ëŸ¬ë¥¼ ë°˜í™˜í•œë‹¤.
- ë‘˜ ë‹¤ ìˆ˜ì € ë¨¼ì € ìž¡ê³  í¬í¬ë¥¼ ì§‘ê²Œ ë§Œë“¤ë©´ í”„ë¡œê·¸ëž¨ì´ ë©ˆì¶”ëŠ” ë¬¸ì œëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
- í•˜ì§€ë§Œ ì‹¤ì œ ì‹¤ë¬´ì—ì„œëŠ” ë®¤í…ìŠ¤ë“¤ì´ ë³µìž¡í•˜ê²Œ ê¼¬ì—¬ ìžˆì–´ì„œ ë‹¨ìˆœížˆ ìˆœì„œë§Œ ë³€ê²½í•´ì„œëŠ” í•´ê²°í•  ìˆ˜ ì—†ëŠ” ê²½ìš°ê°€ ìžˆë‹¤.
- ê·¸ëž˜ì„œ ë°ë“œë½ ë¬¸ì œëŠ” ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë°ì—ì„œ í•´ê²°í•˜ê¸° íž˜ë“  ë‚œì œë‹¤.
*/

/*
ðŸ“Œ ë°ë“œë½ì´ ë°œìƒí•˜ëŠ” ì´ìœ  - ì •ë¦¬
- ë‘ ê°œì˜ ê³ ë£¨í‹´(Aì™€ B)ì´ ë‘ ê°œì˜ ë½(forkì™€ spoon)ì„ ì„œë¡œ ë‹¤ë¥¸ ìˆœì„œë¡œ íšë“í•˜ë ¤ê³  í•˜ë©´ ë°ë“œë½(deadlock) ìƒí™©ì´ ë°œìƒí•  ìˆ˜ ìžˆë‹¤.

- ë°ë“œë½ì€ ë™ì‹œì„± í”„ë¡œê·¸ëž˜ë°ì—ì„œ ë‘ ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œ(Goì—ì„œëŠ” ê³ ë£¨í‹´)ê°€ ì„œë¡œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì†Œìœ í•˜ê³  ìžˆëŠ” ìžì›ì„ ê¸°ë‹¤ë¦¬ëŠë¼ ì˜ì›ížˆ ë©ˆì¶”ëŠ” ìƒíƒœë¥¼ ë§í•œë‹¤.
- Goì—ì„œëŠ” ë‘ ê°œ ì´ìƒì˜ ê³ ë£¨í‹´ì´ ë™ì¼í•œ ë®¤í…ìŠ¤ë¥¼ ë‹¤ë¥¸ ìˆœì„œë¡œ íšë“í•˜ë ¤ê³  í•  ë•Œ ì£¼ë¡œ ë°ë“œë½ì´ ë°œìƒí•œë‹¤.
*/
